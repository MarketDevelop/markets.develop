/* -----------------------------------------------*/// loading
/* -----------------------------------------------*/var loading=function(e){var t={elm:document.getElementById("js-loading"),fadeTimer:200};if(e==="show")t.elm.setAttribute("data-loading","true");else if(e==="hide"){setTimeout(function(){t.elm.setAttribute("data-loading","fade")},t.fadeTimer);setTimeout(function(){t.elm.setAttribute("data-loading","false")},t.fadeTimer*2)}},navControl=function(){var e={list:document.getElementById("js-nav-menu-list"),open:document.getElementById("js-nav-menu-btn-open"),close:document.getElementById("js-nav-menu-btn-close"),anc:function(){return $(this.list).find("li").find("a")},flg:!1,hover:!1},t=function(){if(e.flg!==!0){$(e.list).addClass("is-show");e.flg=!0}},n=function(){if(e.flg!==!1){$(e.list).removeClass("is-show");e.flg=!1}};$(e.open).on("click",function(e){t();e.preventDefault()});$(e.close).on("click",function(e){n();e.preventDefault()});$(e.anc()).on("click",function(){n()});$("body").on("mouseup",function(){e.hover!==!0&&n()});$(document).on("mouseenter","#js-nav-menu-list",function(){e.hover=!0});$(document).on("mouseleave","#js-nav-menu-list",function(){e.hover=!1})},pageScroll=function(e,t){var n={minSpeed:800,easing:"easeInOutQuart"},r=parseInt(Math.floor($(window).height()),10),i=parseInt(Math.floor($("#container").outerHeight(!0)),10),s=0,o=null,u=n.easing,a;t!==null?a=e:a=$(e).attr("href");var f=a.substr(a.lastIndexOf("#"),a.length);if(f==="#"||f==="#menu")return;var l=$(""+f+"");s=Math.floor($(l).offset().top);o=Math.abs($(window).scrollTop()-s)/2;i-s<r&&(s-=r-(i-s));o<n.minSpeed&&(o=n.minSpeed);$("html,body").stop().animate({scrollTop:s},o,u);var c=function(){$("html,body").stop();return};window.addEventListener&&window.addEventListener("DOMMouseScroll",c,!1);window.onmousewheel=document.onmousewheel=c;var h=null;$("html").on("keydown",function(e){e!==null?h=e.which:h=event.keyCode;if(e.keyCode===37||e.keyCode===38||e.keyCode===39||e.keyCode===40||e.keyCode===27){$("html,body").stop();return}})},smoothScroll=function(){var e=document.querySelectorAll('[data-scroll="true"]');$(e).on("click",function(e){pageScroll(this,null);e.preventDefault()})},modalWin=function(e){if($("html.ie8").length>0)return;var t=document.querySelectorAll("[data-zoom]");if(t.length<=0)return!1;var n={elm:document.getElementById("js-modal-win"),inner:document.getElementById("js-modal-win-inner"),flg:!1,anim:!1,hover:!1,fadeTimer:300,ypos:84};if(e==="init"){n.bg=document.createElement("div");n.bg.setAttribute("id","back-layer");n.bg.setAttribute("data-modal-bg","false");var r=document.getElementsByTagName("body")[0];r.appendChild(n.bg)}else n.bg=document.getElementById("back-layer");n.close=document.createElement("a");n.close.setAttribute("id","modal-close");$(n.close).addClass("btn").append('<i class="icon-close-02"></i>');n.closeText=document.createTextNode("閉じる");n.close.appendChild(n.closeText);var i=function(){$(document).on("mouseenter","#js-modal-win-inner article",function(){n.hover=!0});$(document).on("mouseleave","#js-modal-win-inner article",function(){n.hover=!1})},s=function(){if(n.anim!==!0){n.elm.setAttribute("data-modal-win","fade");n.bg.setAttribute("data-modal-bg","fade");setTimeout(function(){n.elm.setAttribute("data-modal-win","");n.bg.setAttribute("data-modal-bg","");n.href.setAttribute("tabindex","0");$(n.href).focus();n.flg=!1},n.fadeTimer)}},o=function(){$(n.bg).on("click",function(e){s();e.preventDefault()});$(n.close).on("click",function(e){s();e.preventDefault()});$(n.elm).on("click",function(e){if(n.hover!==!0){s();e.preventDefault()}})},u=function(e){$(e).find("ul").first().css({"max-height":$(window).height()-230})};$(t).on("click",function(e){if(n.anim!==!1){e.preventDefault();return}n.anim=!0;n.elm.setAttribute("data-modal-win","fade");n.flg!==!0&&n.bg.setAttribute("data-modal-bg","fade");n.flg=!0;n.href=this;setTimeout(function(){var e=$(n.href).attr("href");n.labellebyId=$(n.href).attr("id");loading("show");$(n.inner).load(""+e+" article",function(){n.article=$(this).find("article");$(n.article).append(n.close);$(n.article).hasClass("article-single")&&$(n.article).find(".article-permalink").removeClass("is-hidden");n.elm.setAttribute("data-modal-win","true");n.bg.setAttribute("data-modal-bg","true");$(n.elm).css({top:$(window).scrollTop()+n.ypos});$("html.touch").length<1&&$(n.article).hasClass("list-category")&&u(n.article);o();i();$(n.elm).find("h1").attr("tabindex","0");$(n.elm).find("h1").first().focus();loading("hide");n.anim=!1})},n.fadeTimer);e.preventDefault()});var a;$("html").on("keydown",function(e){e!==null?a=e.which:a=event.keyCode;e.keyCode===27&&s()})},ieFix=function(){var e=$("article.article"),t=e.length;for(var n=0;n<t;n++){(n+1)%2===0&&$(e[n]).addClass("nth-child-2n");(n+1)%3===0&&$(e[n]).addClass("nth-child-3n")}},setNum=function(e){e<10?e="00"+e:e<100&&(e="0"+e);return e},articleLoading=function(){var e={main:function(){return $('[role="main"]')},btn:function(){return document.querySelectorAll("[data-btn-down]")},box:function(){return document.querySelectorAll("[data-more-box]")},more:function(){return $("div.js-more-link")},modal:null,count:1,margin:150,process:!1,end:!1,num:null};e.link=$(e.more()).find("a").first().attr("href");if(e.more().find("a").length<1)$("a.icon-down").attr("data-scroll","true").removeClass("js-ajax-load");else{var t=function(t){loading("show");$.ajax({type:"GET",url:e.link,dataType:"html",timeout:1e4,success:function(n){e.count=$(e.box()).last().attr("data-more-box");e.count++;e.elm=$(e.box()).last();$(e.elm).html($(n).find("div.main-wrapper"));e.num=setNum(e.count);$(e.elm).find("div.main-anchor").attr("id","main-"+e.num);$(e.elm).find("a.icon-up").attr("href","#main-"+setNum(e.count-1));$("a.icon-down").eq(e.count-2).attr("href","#main-"+e.num);$("a.icon-down").eq(e.count-2).attr("data-scroll","true").removeClass("js-ajax-load");$(e.elm).find("span.num").text(e.num);e.num%2===0&&$(e.elm).find("div.main-wrapper").addClass("even");$("a.article-img").find("img").last().imagesLoaded(function(){loading("hide");$(e.main()).append('<div data-more-box="'+e.count+'">');e.link=e.link.replace(/(.*)(\/page\/)[0-9]+(\/.*)/g,"$1$2"+(e.count+1)+"$3");$(e.more()).find("a").attr("href",e.newlink);$(e.more()).css("display","none");t==="click"&&pageScroll("#main-"+setNum(e.count),!0);modalWin();smoothScroll();$("html.ie8").length>0&&ieFix();setTimeout(function(){e.process=!1},0)})},error:function(){loading("hide");e.process=!1;e.end=!0;t==="click"&&pageScroll("#bottom",!0)}})};$(e.more()).css("display","none");$(window).on("scroll",function(){e.modal=document.querySelectorAll('[data-modal-win="true"]');if(e.end!==!0&&e.process!==!0&&e.modal.length<1&&$("#container").height()-e.margin<=$(window).scrollTop()+$(window).height()){e.process=!0;t("scroll")}});$(document).on("click","a.js-ajax-load",function(n){n.preventDefault();if(e.end!==!0&&e.process!==!0){e.process=!0;t("click")}e.end===!0&&pageScroll(this,null)})}};$(function(){navControl();modalWin("init");articleLoading();smoothScroll();$("html.ie8").length>0&&ieFix()});